
//CREATE STATEMENTS

create database assignment;
use assignment;

create table coach(
coach_id int primary key,
mileage int
);

create table station (
station_id int primary key,
name varchar(120) not null
);

create table train (
train_id int primary key,
name text not null
);

create table travel_agent (
travel_agent_id int primary key,
name varchar(120) not null,
contact bigint not null
);

create table discount (
type varchar(30) primary key,
discount real not null
);

create table driver (
driver_id int primary key,
name varchar(120) not null,
city_of_residence varchar(120) not null,
rest_day varchar(10) not null
);

create table passenger (
passenger_id int primary key,
name varchar(120) not null,
age int not null,
contact bigint not null,
type varchar(30) not null
);

alter table passenger add foreign key (type) references discount(type);

create table route (
route_id int primary key,
start_id int not null,
destination_id int not null,
distance int not null
);

alter table route add foreign key (start_id) references station(station_id);
alter table route add foreign key (destination_id) references station(station_id);

create table schedule (
schedule_id int primary key,
date date not null,
route_id int not null,
train_id int not null,
driver_id int not null,
codriver_id int not null,
standby_driver_id int,
standby_codriver_id int,
standby_train_id int,
);

alter table schedule add foreign key (route_id) references route(route_id);
alter table schedule add foreign key (train_id) references train(train_id);
alter table schedule add foreign key (driver_id) references driver(driver_id);
alter table schedule add foreign key (codriver_id) references driver(driver_id);
alter table schedule add foreign key (standby_driver_id) references driver(driver);
alter table schedule add foreign key (standby_codriver_id) references driver(driver_id);
alter table schedule add foreign key (standby_train_id) references train(train_id);

create table schedule_station(
schedule_id int,
station_id int,
exp_arrival_time datetime not null,
exp_departure_time datetime not null,
actual_arrival_time datetime,
actual_departure_time datetime,
primary key (schedule_id,station_id)
);

alter table schedule_station add foreign key (schedule_id) references schedule(schedule_id);
alter table schedule_station add foreign key (station_id) references station(station_id);

create table seat (
seat_id int primary key,
coach_id int not null
);

alter table seat add foreign key (coach_id) references coach(coach_id);

create table ticket (
ticket_id int primary key,
seat_id int not null,
board_id int not null,
alight_id int not null,
schedule_id int not null,
travel_agent int,
booking_date date not null,
passenger_id int not null,
gross_amount int not null,
confirmed bool not null
);

alter table add foreign key (seat_id) references seat(seat_id);
alter table add foreign key (board_id) references station(station_id);
alter table add foreign key (alight_id) references station_id(station_id);
alter table add foreign key (schedule_id) references schedule(schedule_id);
alter table add foreign key (travel_agent) references travel_agent(travel_agent_id);
alter table add foreign key (passenger_id) references passenger(passenger_id);

create table coach_schedule (
coach_id int,
schedule_id int,
primary key(coach_id,schedule_id)
);

alter table coach_schedule add foreign key (coach_id) references coach(coach_id);
alter table coach_schedule add foreign key (schedule_id) references schedule(schedule_id);

create table maintenance(
maintenance_id int primary key,
coach_id int not null,
date date int not null,
previous_maintenance_id int not null,
done bool not null
);

alter table maintenance add foreign key coach_id references coach(coach_id);
alter table maintenance add foreign key (previous_maintenance_id) references maintenance(maintenance_id);
